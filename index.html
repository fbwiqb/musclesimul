<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∑ºÏú° ÏàòÏ∂ï Ïä¨ÎùºÏù¥Îî© ÌïÑÎùºÎ©òÌä∏ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004999 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        h2 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #0066cc;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
        }
        
        .control-panel {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 2px solid #0066cc;
        }
        
        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 18px;
            color: #0066cc;
        }
        
        .length-value {
            color: #0066cc;
            font-size: 22px;
            font-weight: bold;
        }
        
        .delta-display {
            color: #666;
            font-size: 16px;
            margin-left: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #cce5ff;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .svg-container {
            background: white;
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            overflow-x: auto;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        .info-card {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
        }
        
        .info-card h4 {
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .info-card ul {
            list-style: disc;
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .delta-positive {
            color: #28a745;
        }
        
        .delta-negative {
            color: #dc3545;
        }
        
        .delta-info {
            color: #0066cc;
        }
        
        .calculator {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
            margin-bottom: 32px;
        }
        
        .calculator h4 {
            font-weight: bold;
            margin-bottom: 16px;
            color: #0066cc;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            border: 1px solid #0066cc;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }
        
        td:nth-child(4) {
            text-align: center;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 14px;
        }
        
        .operator-select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            background: #f0f7ff;
        }
        
        footer {
            margin-top: 40px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 2px solid #0066cc;
            text-align: center;
        }
        
        .footer-content {
            margin-bottom: 10px;
            color: #333;
        }
        
        .developer-log {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0066cc;
        }
        
        .modal-header h3 {
            color: #0066cc;
            font-size: 22px;
        }
        
        .close {
            color: #666;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #0066cc;
        }
        
        .modal-body {
            line-height: 1.8;
            color: #333;
        }
        
        .modal-body h4 {
            color: #0066cc;
            margin: 20px 0 10px 0;
            font-size: 18px;
        }
        
        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
        }
        
        .modal-body strong {
            color: #0066cc;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>üî¨ Í∑ºÏú° ÏàòÏ∂ï Ïä¨ÎùºÏù¥Îî© ÌïÑÎùºÎ©òÌä∏ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h2>
        </div>

        <div class="button-group">
            <button class="btn" onclick="openModal('theory')">üìñ Ïù¥Î°† ÏÑ§Î™Ö</button>
            <button class="btn" onclick="openModal('usage')">‚ùì ÏÇ¨Ïö© Î∞©Î≤ï</button>
        </div>

        <div class="control-panel">
            <label class="control-label">
                Í∑ºÏ†à(Sarcomere) Í∏∏Ïù¥: 
                <span id="lengthDisplay" class="length-value">4.50 Œºm</span>
                <span id="deltaDisplay" class="delta-display">(Í∏∞Ï§ÄÍ∞í)</span>
            </label>
            <input type="range" id="sarcomereSlider" min="0" max="18" value="9" step="1">
            <div class="range-labels">
                <span>3.6 Œºm (ÏµúÎåÄ ÏàòÏ∂ï)</span>
                <span style="color: #0066cc; font-weight: bold;">4.5 Œºm (Í∏∞Ï§ÄÍ∞í)</span>
                <span>5.4 Œºm (Ïù¥ÏôÑ)</span>
            </div>
        </div>

        <div class="svg-container">
            <svg id="muscleSvg" width="800" height="300"></svg>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h4>üìè ÌòÑÏû¨ Í∏∏Ïù¥ Ï†ïÎ≥¥</h4>
                <ul id="lengthList"></ul>
            </div>
            <div class="info-card">
                <h4>üìä Í∏∏Ïù¥ Î≥ÄÌôî (Í∏∞Ï§ÄÍ∞í ÎåÄÎπÑ)</h4>
                <ul id="changesList"></ul>
            </div>
        </div>

        <div class="calculator">
            <h4>üßÆ Í∏∏Ïù¥ Í≥ÑÏÇ∞Í∏∞</h4>
            <table>
                <thead>
                    <tr>
                        <th>ÏÑ†ÌÉù 1</th>
                        <th>Ïó∞ÏÇ∞Ïûê</th>
                        <th>ÏÑ†ÌÉù 2</th>
                        <th>Í≤∞Í≥º</th>
                    </tr>
                </thead>
                <tbody id="calculatorTable"></tbody>
            </table>
        </div>

        <footer>
            <div class="footer-content">
                <strong>Ï∂©ÎÇ®ÏÇºÏÑ±Í≥†Îì±ÌïôÍµê Í≥ºÌïôÍµêÏÇ¨ Ïã†ÎèÑÍ≤Ω</strong><br>
                ÍµêÏú°Ïö© ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ | 2025
            </div>
            <div class="developer-log">
                Î≤ÑÏ†Ñ 1.1 | ÏàòÏ†ï: Í∏∞Ï§ÄÍ∞í 4.5Œºm ÏÑ§Ï†ï, MÏÑ† ÎèôÏ†Å ÏúÑÏπò Ï°∞Ï†ï
            </div>
        </footer>
    </div>

    <!-- Ïù¥Î°† ÏÑ§Î™Ö Î™®Îã¨ -->
    <div id="theoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìñ Ïä¨ÎùºÏù¥Îî© ÌïÑÎùºÎ©òÌä∏ Ïù¥Î°†</h3>
                <span class="close" onclick="closeModal('theory')">&times;</span>
            </div>
            <div class="modal-body">
                <h4>Í∏∞Î≥∏ ÏõêÎ¶¨</h4>
                <p>Í∑ºÏú° ÏàòÏ∂ï Ïãú <strong>Ïï°Ìã¥(Í∞ÄÎäî ÌïÑÎùºÎ©òÌä∏)</strong>Ïù¥ <strong>ÎßàÏù¥Ïò§Ïã†(ÍµµÏùÄ ÌïÑÎùºÎ©òÌä∏)</strong> ÏÇ¨Ïù¥Î°ú ÎØ∏ÎÅÑÎü¨Ï†∏ Îì§Ïñ¥Í∞ÄÎ©¥ÏÑú Í∑ºÏ†à(sarcomere)Ïùò Í∏∏Ïù¥Í∞Ä ÏßßÏïÑÏßëÎãàÎã§.</p>
                
                <h4>Ï£ºÏöî Íµ¨Ï°∞</h4>
                <ul>
                    <li><strong>ZÏÑ†</strong>: Í∑ºÏ†àÏùò Ïñë ÎÅù Í≤ΩÍ≥Ñ</li>
                    <li><strong>MÏÑ†</strong>: Í∑ºÏ†àÏùò Ï†ïÏ§ëÏïô, ÎßàÏù¥Ïò§Ïã†Ïùò Ï§ëÏã¨</li>
                    <li><strong>AÎåÄ</strong>: ÎßàÏù¥Ïò§Ïã† ÌïÑÎùºÎ©òÌä∏Í∞Ä ÏûàÎäî ÏòÅÏó≠ (1.8 Œºm, ÏùºÏ†ï)</li>
                    <li><strong>IÎåÄ</strong>: Ïï°Ìã¥Îßå ÏûàÎäî ÏòÅÏó≠ (ÏàòÏ∂ï Ïãú Í∞êÏÜå)</li>
                    <li><strong>HÎåÄ</strong>: ÎßàÏù¥Ïò§Ïã†Îßå ÏûàÎäî ÏòÅÏó≠ (ÏàòÏ∂ï Ïãú Í∞êÏÜå)</li>
                </ul>
                
                <h4>ÏàòÏ∂ï Ïãú Î≥ÄÌôî</h4>
                <ul>
                    <li>Í∑ºÏ†à Í∏∏Ïù¥ ‚Üì (ZÏÑ† Í∞Ñ Í±∞Î¶¨ Í∞êÏÜå)</li>
                    <li>IÎåÄ Í∏∏Ïù¥ ‚Üì</li>
                    <li>HÎåÄ Í∏∏Ïù¥ ‚Üì</li>
                    <li>AÎåÄ Í∏∏Ïù¥ = ÏùºÏ†ï</li>
                    <li>Ïï°Ìã¥-ÎßàÏù¥Ïò§Ïã† Í≤πÏπòÎäî Íµ¨Í∞Ñ ‚Üë</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ÏÇ¨Ïö© Î∞©Î≤ï Î™®Îã¨ -->
    <div id="usageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ùì ÏÇ¨Ïö© Î∞©Î≤ï</h3>
                <span class="close" onclick="closeModal('usage')">&times;</span>
            </div>
            <div class="modal-body">
                <h4>1. Ïä¨ÎùºÏù¥Îçî Ï°∞Ïûë</h4>
                <p>Ïä¨ÎùºÏù¥ÎçîÎ•º Ï¢åÏö∞Î°ú ÏõÄÏßÅÏó¨ Í∑ºÏ†àÏùò Í∏∏Ïù¥Î•º Î≥ÄÌôîÏãúÌÇµÎãàÎã§.</p>
                <ul>
                    <li>ÏôºÏ™Ω: ÏµúÎåÄ ÏàòÏ∂ï ÏÉÅÌÉú (3.6 Œºm)</li>
                    <li>Ï§ëÏïô: Í∏∞Ï§Ä ÏÉÅÌÉú (4.5 Œºm)</li>
                    <li>Ïò§Î•∏Ï™Ω: Ïù¥ÏôÑ ÏÉÅÌÉú (5.4 Œºm)</li>
                </ul>
                
                <h4>2. ÏãúÍ∞ÅÌôî Í¥ÄÏ∞∞</h4>
                <p>Í∞Å Íµ¨Ï°∞Ïùò Î≥ÄÌôîÎ•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏Ìï©ÎãàÎã§.</p>
                <ul>
                    <li>ÌååÎûÄÏÉâ ÏÑ†: Ïï°Ìã¥ ÌïÑÎùºÎ©òÌä∏</li>
                    <li>Îπ®Í∞ÑÏÉâ ÏÑ†: ÎßàÏù¥Ïò§Ïã† ÌïÑÎùºÎ©òÌä∏</li>
                    <li>ÌååÎûÄÏÉâ ÍµµÏùÄ ÏÑ†: ZÏÑ†</li>
                    <li>Ï£ºÌô©ÏÉâ Ï†êÏÑ†: MÏÑ†</li>
                </ul>
                
                <h4>3. Í∏∏Ïù¥ Ï†ïÎ≥¥ ÌôïÏù∏</h4>
                <p>"ÌòÑÏû¨ Í∏∏Ïù¥ Ï†ïÎ≥¥"ÏóêÏÑú Í∞Å Íµ¨Ï°∞Ïùò Í∏∏Ïù¥Î•º ÌôïÏù∏ÌïòÍ≥†, "Í∏∏Ïù¥ Î≥ÄÌôî"ÏóêÏÑú Í∏∞Ï§ÄÍ∞í(4.5 Œºm) ÎåÄÎπÑ Î≥ÄÌôîÎüâÏùÑ ÌôïÏù∏Ìï©ÎãàÎã§.</p>
                
                <h4>4. Í≥ÑÏÇ∞Í∏∞ ÌôúÏö©</h4>
                <p>ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ÏóêÏÑú Îëê Í∞íÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Ïó∞ÏÇ∞ÏûêÎ•º ÏÑ†ÌÉùÌïòÏó¨ Í¥ÄÍ≥ÑÏãùÏùÑ Í≤ÄÏ¶ùÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
            </div>
        </div>
    </div>

    <script>
        // ÏÉÅÏàò Ï†ïÏùò
        const umToPx = (um) => um / (5.0 / 700);
        const aBandUm = 1.8;
        const actinUm = 1.8;
        const actinLength = umToPx(actinUm);
        const myosinLengthPx = umToPx(aBandUm);
        const centerX = (750 + 50) / 2;
        const baselineSarcomere = 4.5; // Í∏∞Ï§ÄÍ∞í

        // Í∑ºÏ†à Í∏∏Ïù¥ ÌÖåÏù¥Î∏î (ÏôºÏ™Ω: ÏàòÏ∂ï, Ïò§Î•∏Ï™Ω: Ïù¥ÏôÑ)
        const sarcomereLengthTable = Array.from({ length: 19 }, (_, i) => 3.6 + i * 0.1);

        // ÏÑ†ÌÉù Í∞ÄÎä•Ìïú Í∏∏Ïù¥ ÏòµÏÖò
        const lengthOptions = [
            "AÎåÄ Í∏∏Ïù¥", "ÎßàÏù¥Ïò§Ïã†", "Ïï°Ìã¥", "HÎåÄ Í∏∏Ïù¥", 
            "IÎåÄ Í∏∏Ïù¥", "Í≤πÏπòÎäî Íµ¨Í∞Ñ", "¬Ω IÎåÄ Í∏∏Ïù¥", "¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ"
        ];

        // Í∏∞Ï§ÄÍ∞í (4.5 Œºm Í∏∞Ï§Ä)
        const referenceValues = {
            "HÎåÄ Í∏∏Ïù¥": 0.9,        // 4.5 - 1.8 - 1.8 = 0.9
            "IÎåÄ Í∏∏Ïù¥": 2.7,        // 4.5 - 1.8 = 2.7
            "¬Ω IÎåÄ Í∏∏Ïù¥": 1.35,     // 2.7 / 2 = 1.35
            "Í≤πÏπòÎäî Íµ¨Í∞Ñ": 0.9,     // 5.4 - 4.5 = 0.9
            "¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ": 0.45   // 0.9 / 2 = 0.45
        };

        // Í≥ÑÏÇ∞Í∏∞ ÏÉÅÌÉú
        let calculatorRows = Array(6).fill(null).map(() => ["", "+", ""]);

        // Î™®Îã¨ Ï†úÏñ¥
        function openModal(type) {
            document.getElementById(type + 'Modal').style.display = 'block';
        }

        function closeModal(type) {
            document.getElementById(type + 'Modal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // SVG Í∑∏Î¶¨Í∏∞ Ìï®Ïàò
        function drawMuscle(sarcomereUm) {
            const svg = document.getElementById('muscleSvg');
            svg.innerHTML = '';

            const minSarcomereUm = 2 * actinUm;
            sarcomereUm = Math.max(sarcomereUm, minSarcomereUm);

            const pxToUm = 5.0 / 700;
            const pxLength = sarcomereUm / pxToUm;
            const leftZ = centerX - pxLength / 2;
            const rightZ = centerX + pxLength / 2;

            // ÎßàÏù¥Ïò§Ïã†ÏùÑ Í∑ºÏ†à Ï§ëÏã¨Ïóê Î∞∞Ïπò
            const myosinStart = centerX - myosinLengthPx / 2;
            const myosinEnd = centerX + myosinLengthPx / 2;

            const hStart = leftZ + actinLength;
            const hEnd = rightZ - actinLength;

            // ZÏÑ†
            svg.innerHTML += `
                <line x1="${leftZ}" y1="80" x2="${leftZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <line x1="${rightZ}" y1="80" x2="${rightZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <text x="${leftZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">ZÏÑ†</text>
                <text x="${rightZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">ZÏÑ†</text>
            `;

            // Ïï°Ìã¥ ÌïÑÎùºÎ©òÌä∏
            [100, 140, 180, 220].forEach(y => {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                    <rect x="${rightZ - actinLength}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                `;
            });

            // ÎßàÏù¥Ïò§Ïã† ÌïÑÎùºÎ©òÌä∏ (Ï§ëÏã¨ Í∏∞Ï§Ä)
            [120, 160, 200].forEach(y => {
                svg.innerHTML += `<rect x="${myosinStart}" y="${y}" width="${myosinLengthPx}" height="18" fill="#DC143C" rx="4"/>`;
            });

            // MÏÑ† (Í∑ºÏ†à Ï§ëÏã¨)
            const mLineX = centerX;
            svg.innerHTML += `
                <line x1="${mLineX}" y1="80" x2="${mLineX}" y2="220" stroke="#FFA500" stroke-width="3" stroke-dasharray="5 5"/>
                <text x="${mLineX}" y="70" font-size="14" text-anchor="middle" fill="#FFA500" font-weight="bold">MÏÑ†</text>
            `;

            // AÎåÄ
            svg.innerHTML += `
                <rect x="${myosinStart}" y="40" width="${myosinLengthPx}" height="12" stroke="#333" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                <text x="${mLineX}" y="30" font-size="14" text-anchor="middle" font-weight="bold">AÎåÄ</text>
            `;

            // HÎåÄ
            if (hEnd > hStart) {
                svg.innerHTML += `
                    <rect x="${hStart}" y="250" width="${hEnd - hStart}" height="12" stroke="#4169E1" fill="rgba(65,105,225,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(hStart + hEnd) / 2}" y="280" font-size="14" text-anchor="middle" fill="#4169E1" font-weight="bold">HÎåÄ</text>
                `;
            }

            // IÎåÄ
            if (myosinStart > leftZ) {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="270" width="${myosinStart - leftZ}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(leftZ + myosinStart) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">¬Ω IÎåÄ</text>
                `;
            }
            if (rightZ > myosinEnd) {
                svg.innerHTML += `
                    <rect x="${myosinEnd}" y="270" width="${rightZ - myosinEnd}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(rightZ + myosinEnd) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">¬Ω IÎåÄ</text>
                `;
            }
        }

        // Í∏∏Ïù¥ Í≥ÑÏÇ∞
        function calculateLengths(sarcomereUm) {
            const contractionUm = 5.4 - sarcomereUm;
            const hBandUm = Math.max(0, sarcomereUm - 2 * actinUm);
            const iBandUmCurrent = Math.max(0, sarcomereUm - aBandUm);
            const iHalfBandUm = iBandUmCurrent / 2;
            const overlapUm = contractionUm;

            return {
                "AÎåÄ Í∏∏Ïù¥": aBandUm,
                "ÎßàÏù¥Ïò§Ïã†": aBandUm,
                "Ïï°Ìã¥": actinUm,
                "HÎåÄ Í∏∏Ïù¥": hBandUm,
                "IÎåÄ Í∏∏Ïù¥": iBandUmCurrent,
                "Í≤πÏπòÎäî Íµ¨Í∞Ñ": overlapUm,
                "¬Ω IÎåÄ Í∏∏Ïù¥": iHalfBandUm,
                "¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ": overlapUm / 2
            };
        }

        // ÌòÑÏû¨ Í∏∏Ïù¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateLengthInfo(lengths) {
            const lengthList = document.getElementById('lengthList');
            const items = [
                { name: "Í∑ºÏ†à Í∏∏Ïù¥", value: parseFloat(document.getElementById('lengthDisplay').textContent) },
                { name: "AÎåÄ Í∏∏Ïù¥", value: lengths["AÎåÄ Í∏∏Ïù¥"] },
                { name: "Ïï°Ìã¥ Í∏∏Ïù¥", value: lengths["Ïï°Ìã¥"] },
                { name: "HÎåÄ Í∏∏Ïù¥", value: lengths["HÎåÄ Í∏∏Ïù¥"] },
                { name: "IÎåÄ Í∏∏Ïù¥", value: lengths["IÎåÄ Í∏∏Ïù¥"] },
                { name: "Í≤πÏπòÎäî Íµ¨Í∞Ñ", value: lengths["Í≤πÏπòÎäî Íµ¨Í∞Ñ"] }
            ];

            lengthList.innerHTML = items.map(item => 
                `<li>${item.name}: <strong>${item.value.toFixed(2)} Œºm</strong></li>`
            ).join('');
        }

        // Î≥ÄÌôî Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateChanges(lengths) {
            const changesList = document.getElementById('changesList');
            const items = [
                { name: "HÎåÄ Í∏∏Ïù¥", value: lengths["HÎåÄ Í∏∏Ïù¥"], ref: referenceValues["HÎåÄ Í∏∏Ïù¥"] },
                { name: "IÎåÄ Í∏∏Ïù¥", value: lengths["IÎåÄ Í∏∏Ïù¥"], ref: referenceValues["IÎåÄ Í∏∏Ïù¥"] },
                { name: "Í≤πÏπòÎäî Íµ¨Í∞Ñ", value: lengths["Í≤πÏπòÎäî Íµ¨Í∞Ñ"], ref: referenceValues["Í≤πÏπòÎäî Íµ¨Í∞Ñ"] },
                { name: "¬Ω IÎåÄ Í∏∏Ïù¥", value: lengths["¬Ω IÎåÄ Í∏∏Ïù¥"], ref: referenceValues["¬Ω IÎåÄ Í∏∏Ïù¥"] },
                { name: "¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ", value: lengths["¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ"], ref: referenceValues["¬Ω Í≤πÏπòÎäî Íµ¨Í∞Ñ"] }
            ];

            changesList.innerHTML = items.map(item => {
                const delta = item.value - item.ref;
                const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : 'delta-info';
                return `<li>${item.name}: <strong>${item.value.toFixed(2)} Œºm</strong> <span class="${deltaClass}">(Œî ${delta.toFixed(2)} Œºm)</span></li>`;
            }).join('');
        }

        // Í≥ÑÏÇ∞Í∏∞ ÌÖåÏù¥Î∏î ÏÉùÏÑ±
        function createCalculatorTable() {
            const table = document.getElementById('calculatorTable');
            table.innerHTML = '';

            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                
                // ÏÑ†ÌÉù 1
                const select1 = document.createElement('select');
                select1.innerHTML = '<option value="">ÏÑ†ÌÉù Ïïà Ìï®</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select1.value = calculatorRows[i][0];
                select1.onchange = () => {
                    calculatorRows[i][0] = select1.value;
                    updateCalculator();
                };

                // Ïó∞ÏÇ∞Ïûê ÏÑ†ÌÉù
                const selectOp = document.createElement('select');
                selectOp.className = 'operator-select';
                selectOp.innerHTML = `
                    <option value="+">+</option>
                    <option value="-">‚àí</option>
                    <option value="*">√ó</option>
                    <option value="/">√∑</option>
                `;
                selectOp.value = calculatorRows[i][1];
                selectOp.onchange = () => {
                    calculatorRows[i][1] = selectOp.value;
                    updateCalculator();
                };

                // ÏÑ†ÌÉù 2
                const select2 = document.createElement('select');
                select2.innerHTML = '<option value="">ÏÑ†ÌÉù Ïïà Ìï®</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select2.value = calculatorRows[i][2];
                select2.onchange = () => {
                    calculatorRows[i][2] = select2.value;
                    updateCalculator();
                };

                const td1 = document.createElement('td');
                td1.appendChild(select1);
                const td2 = document.createElement('td');
                td2.appendChild(selectOp);
                const td3 = document.createElement('td');
                td3.appendChild(select2);
                const td4 = document.createElement('td');
                td4.id = `calc-result-${i}`;

                row.appendChild(td1);
                row.appendChild(td2);
                row.appendChild(td3);
                row.appendChild(td4);
                table.appendChild(row);
            }
        }

        // Í≥ÑÏÇ∞Í∏∞ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        function updateCalculator() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const lengths = calculateLengths(sarcomereUm);

            calculatorRows.forEach((row, idx) => {
                const resultCell = document.getElementById(`calc-result-${idx}`);
                const [key1, operator, key2] = row;
                
                if (!key1 && !key2) {
                    resultCell.textContent = '-';
                } else if (!key1 || !key2) {
                    resultCell.textContent = 'Í∞íÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
                    resultCell.style.color = '#999';
                } else {
                    const v1 = lengths[key1] || 0;
                    const v2 = lengths[key2] || 0;
                    let result;
                    let operatorSymbol;
                    
                    switch(operator) {
                        case '+':
                            result = v1 + v2;
                            operatorSymbol = '+';
                            break;
                        case '-':
                            result = v1 - v2;
                            operatorSymbol = '‚àí';
                            break;
                        case '*':
                            result = v1 * v2;
                            operatorSymbol = '√ó';
                            break;
                        case '/':
                            result = v2 !== 0 ? v1 / v2 : 0;
                            operatorSymbol = '√∑';
                            if (v2 === 0) {
                                resultCell.textContent = '0ÏúºÎ°ú ÎÇòÎàå Ïàò ÏóÜÏäµÎãàÎã§';
                                resultCell.style.color = '#dc3545';
                                return;
                            }
                            break;
                        default:
                            result = v1 + v2;
                            operatorSymbol = '+';
                    }
                    
                    // Í∏∞Ï§ÄÍ∞í Í≥ÑÏÇ∞ (ÎçîÌïòÍ∏∞Ïùº ÎïåÎßå Œî ÌëúÏãú)
                    if (operator === '+') {
                        const ref1 = referenceValues[key1] || 0;
                        const ref2 = referenceValues[key2] || 0;
                        const delta = result - (ref1 + ref2);
                        const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : '';
                        resultCell.innerHTML = `${result.toFixed(2)} Œºm <span class="${deltaClass}">(Œî ${delta.toFixed(2)} Œºm)</span>`;
                    } else {
                        // Îã§Î•∏ Ïó∞ÏÇ∞ÏùÄ Í≤∞Í≥ºÎßå ÌëúÏãú
                        resultCell.innerHTML = `<strong>${result.toFixed(2)}</strong> ${operator === '/' ? '' : 'Œºm'}`;
                    }
                    resultCell.style.color = '#333';
                }
            });
        }

        // Î©îÏù∏ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function update() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const delta = sarcomereUm - baselineSarcomere;
            
            document.getElementById('lengthDisplay').textContent = `${sarcomereUm.toFixed(2)} Œºm`;
            
            // Í∏∞Ï§ÄÍ∞íÍ≥ºÏùò Ï∞®Ïù¥ ÌëúÏãú
            const deltaDisplay = document.getElementById('deltaDisplay');
            if (Math.abs(delta) < 0.01) {
                deltaDisplay.textContent = '(Í∏∞Ï§ÄÍ∞í)';
                deltaDisplay.style.color = '#666';
            } else {
                const sign = delta > 0 ? '+' : '';
                deltaDisplay.textContent = `(${sign}${delta.toFixed(2)} Œºm)`;
                deltaDisplay.style.color = delta > 0 ? '#28a745' : '#dc3545';
            }
            
            drawMuscle(sarcomereUm);
            
            const lengths = calculateLengths(sarcomereUm);
            updateLengthInfo(lengths);
            updateChanges(lengths);
            updateCalculator();
        }

        // Ï¥àÍ∏∞Ìôî
        document.getElementById('sarcomereSlider').addEventListener('input', update);
        createCalculatorTable();
        update();
    </script>
</body>
</html>
