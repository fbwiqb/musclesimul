<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼ìœ¡ ìˆ˜ì¶• ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004999 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        h2 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #0066cc;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
        }
        
        .control-panel {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 2px solid #0066cc;
        }
        
        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 18px;
            color: #0066cc;
        }
        
        .length-value {
            color: #0066cc;
            font-size: 22px;
            font-weight: bold;
        }
        
        .delta-display {
            color: #666;
            font-size: 16px;
            margin-left: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #cce5ff;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .svg-container {
            background: white;
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            overflow-x: auto;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        .info-card {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
        }
        
        .info-card h4 {
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .info-card ul {
            list-style: disc;
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .delta-positive {
            color: #28a745;
        }
        
        .delta-negative {
            color: #dc3545;
        }
        
        .delta-info {
            color: #0066cc;
        }
        
        .calculator {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
            margin-bottom: 32px;
        }
        
        .calculator h4 {
            font-weight: bold;
            margin-bottom: 16px;
            color: #0066cc;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            border: 1px solid #0066cc;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }
        
        td:nth-child(4) {
            text-align: center;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 14px;
        }
        
        .operator-select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            background: #f0f7ff;
        }
        
        footer {
            margin-top: 40px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 2px solid #0066cc;
            text-align: center;
        }
        
        .footer-content {
            margin-bottom: 10px;
            color: #333;
        }
        
        .developer-log {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0066cc;
        }
        
        .modal-header h3 {
            color: #0066cc;
            font-size: 24px;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #0066cc;
        }
        
        .modal-content h4 {
            color: #0066cc;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .modal-content ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .modal-content p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .svg-container {
                padding: 10px;
            }
            
            h2 {
                font-size: 22px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ¦´ ê·¼ìœ¡ ìˆ˜ì¶• ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì‹œë®¬ë ˆì´í„°</h2>
            <div class="button-group">
                <button class="btn" onclick="openModal('usage')">ğŸ“– ì‚¬ìš©ë²•</button>
                <button class="btn" onclick="openModal('devlog')">ğŸ’» ê°œë°œì ë¡œê·¸</button>
            </div>
        </div>
        
        <div class="control-panel">
            <label class="control-label">
                ê·¼ì ˆ ê¸¸ì´: <span class="length-value" id="lengthDisplay">4.50 Î¼m</span>
                <span class="delta-display" id="deltaDisplay">(ê¸°ì¤€ê°’)</span>
            </label>
            <input type="range" id="sarcomereSlider" min="0" max="20" step="1" value="10">
            <div class="range-labels">
                <span>5.4 Î¼m (ì´ì™„)</span>
                <span>5.0 Î¼m</span>
                <span>4.5 Î¼m (ê¸°ì¤€)</span>
                <span>4.0 Î¼m</span>
                <span>3.6 Î¼m (ìˆ˜ì¶•)</span>
            </div>
        </div>

        <div class="svg-container">
            <svg id="muscleSvg" width="820" height="300"></svg>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h4>ğŸ“ ë³€í•˜ì§€ ì•ŠëŠ” ê¸¸ì´</h4>
                <ul>
                    <li>AëŒ€ ê¸¸ì´: <strong>1.80 Î¼m</strong></li>
                    <li>ë§ˆì´ì˜¤ì‹ : <strong>1.80 Î¼m</strong></li>
                    <li>ì•¡í‹´: <strong>1.80 Î¼m</strong></li>
                </ul>
            </div>
            
            <div class="info-card">
                <h4>ğŸ“Š ê¸¸ì´ ë³€í™” (ìˆ˜ì¶•ì— ë”°ë¼ ë³€í•¨)</h4>
                <ul id="changesList"></ul>
            </div>
        </div>

        <div class="calculator">
            <h4>ğŸ”¢ ê¸¸ì´ ì¡°í•© ê³„ì‚°ê¸°</h4>
            <table>
                <thead>
                    <tr>
                        <th>ì„ íƒ 1</th>
                        <th>ì—°ì‚°</th>
                        <th>ì„ íƒ 2</th>
                        <th>ê²°ê³¼ (Î¼m)</th>
                    </tr>
                </thead>
                <tbody id="calculatorTable"></tbody>
            </table>
        </div>

        <footer>
            <div class="footer-content">
                <strong>Â© 2025 ê·¼ìœ¡ ìˆ˜ì¶• ì‹œë®¬ë ˆì´í„°</strong><br>
                ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ìƒëª…ê³¼í•™ êµìœ¡ìš© ì‹œë®¬ë ˆì´ì…˜ í”„ë¡œê·¸ë¨
            </div>
            <div class="developer-log">
                ê°œë°œ: ì‹ ë„ê²½ | ìµœì¢… ì—…ë°ì´íŠ¸: 2025.01 | Version 1.0
            </div>
        </footer>
    </div>

    <!-- ì‚¬ìš©ë²• ëª¨ë‹¬ -->
    <div id="usageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“– ì‚¬ìš©ë²•</h3>
                <span class="close" onclick="closeModal('usage')">&times;</span>
            </div>
            <h4>ğŸ¯ í”„ë¡œê·¸ë¨ ì†Œê°œ</h4>
            <p>ì´ ì‹œë®¬ë ˆì´í„°ëŠ” ê·¼ìœ¡ ìˆ˜ì¶• ì‹œ ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì´ë¡ ì— ë”°ë¥¸ ê° ë¶€ìœ„ì˜ ê¸¸ì´ ë³€í™”ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
            
            <h4>ğŸ® ì¡°ì‘ ë°©ë²•</h4>
            <ul>
                <li><strong>ìŠ¬ë¼ì´ë” ì¡°ì ˆ:</strong> ê·¼ì ˆ ê¸¸ì´ë¥¼ 5.4 Î¼m (ì´ì™„)ì—ì„œ 3.6 Î¼m (ìˆ˜ì¶•)ê¹Œì§€ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>ê¸°ì¤€ê°’:</strong> 4.5 Î¼mì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³€í™”ëŸ‰ì´ í‘œì‹œë©ë‹ˆë‹¤.</li>
            </ul>
            
            <h4>ğŸ“Š í™”ë©´ êµ¬ì„±</h4>
            <ul>
                <li><strong>SVG ë‹¤ì´ì–´ê·¸ë¨:</strong> ì•¡í‹´(íŒŒë€ìƒ‰), ë§ˆì´ì˜¤ì‹ (ë¹¨ê°„ìƒ‰), Zì„ , Mì„ , AëŒ€, HëŒ€, IëŒ€ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.</li>
                <li><strong>ë³€í•˜ì§€ ì•ŠëŠ” ê¸¸ì´:</strong> AëŒ€, ë§ˆì´ì˜¤ì‹ , ì•¡í‹´ í•„ë¼ë©˜íŠ¸ì˜ ê¸¸ì´ëŠ” í•­ìƒ 1.80 Î¼më¡œ ì¼ì •í•©ë‹ˆë‹¤.</li>
                <li><strong>ê¸¸ì´ ë³€í™”:</strong> HëŒ€, IëŒ€, ê²¹ì¹˜ëŠ” êµ¬ê°„ì˜ ê¸¸ì´ê°€ ìˆ˜ì¶• ì •ë„ì— ë”°ë¼ ë³€í•©ë‹ˆë‹¤.</li>
                <li><strong>ê¸¸ì´ ì¡°í•© ê³„ì‚°ê¸°:</strong> ë‘ ìš”ì†Œë¥¼ ì„ íƒí•˜ê³  ì—°ì‚°(+, âˆ’, Ã—, Ã·)ì„ ì„ íƒí•˜ì—¬ ê²°ê³¼ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    <ul>
                        <li>ë”í•˜ê¸°(+): ë‘ ê¸¸ì´ì˜ í•©ê³¼ ê¸°ì¤€ê°’ ëŒ€ë¹„ ë³€í™”ëŸ‰(Î”) í‘œì‹œ</li>
                        <li>ë¹¼ê¸°(âˆ’): ì²« ë²ˆì§¸ ê°’ì—ì„œ ë‘ ë²ˆì§¸ ê°’ì„ ëº€ ê²°ê³¼</li>
                        <li>ê³±í•˜ê¸°(Ã—): ë‘ ê°’ì˜ ê³±</li>
                        <li>ë‚˜ëˆ„ê¸°(Ã·): ì²« ë²ˆì§¸ ê°’ì„ ë‘ ë²ˆì§¸ ê°’ìœ¼ë¡œ ë‚˜ëˆˆ ë¹„ìœ¨</li>
                    </ul>
                </li>
            </ul>
            
            <h4>ğŸ“š í•™ìŠµ í¬ì¸íŠ¸</h4>
            <ul>
                <li>ê·¼ìœ¡ ìˆ˜ì¶• ì‹œ AëŒ€ ê¸¸ì´ëŠ” ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                <li>HëŒ€ì™€ IëŒ€ëŠ” ìˆ˜ì¶•í• ìˆ˜ë¡ ì§§ì•„ì§‘ë‹ˆë‹¤.</li>
                <li>ì•¡í‹´ê³¼ ë§ˆì´ì˜¤ì‹ ì´ ê²¹ì¹˜ëŠ” êµ¬ê°„ì€ ìˆ˜ì¶•í• ìˆ˜ë¡ ê¸¸ì–´ì§‘ë‹ˆë‹¤.</li>
                <li>ì™„ì „ ìˆ˜ì¶• ì‹œ (3.6 Î¼m) HëŒ€ê°€ ì‚¬ë¼ì§€ê³  ì•¡í‹´ì´ Mì„ ì— ë‹¿ê²Œ ë©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </div>

    <!-- ê°œë°œì ë¡œê·¸ ëª¨ë‹¬ -->
    <div id="devlogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’» ê°œë°œì ë¡œê·¸</h3>
                <span class="close" onclick="closeModal('devlog')">&times;</span>
            </div>
            
            <h4>ğŸ“Œ Version 1.0 (2025.01)</h4>
            <ul>
                <li>âœ… ê·¼ì ˆ ê¸¸ì´ ìŠ¬ë¼ì´ë” ê¸°ëŠ¥ êµ¬í˜„</li>
                <li>âœ… SVG ê¸°ë°˜ ì‹¤ì‹œê°„ ì‹œê°í™”</li>
                <li>âœ… ê¸¸ì´ ë³€í™” ìë™ ê³„ì‚° ë° í‘œì‹œ</li>
                <li>âœ… 6í–‰ ê¸¸ì´ ì¡°í•© ê³„ì‚°ê¸° (4ì¹™ì—°ì‚° ì§€ì›)</li>
                <li>âœ… ë°˜ì‘í˜• ë””ìì¸ ì ìš©</li>
                <li>âœ… ê¸°ì¤€ê°’(4.5 Î¼m) ê¸°ë°˜ ë³€í™”ëŸ‰ í‘œì‹œ</li>
                <li>âœ… ì—°ì‚°ì ì„ íƒ ê¸°ëŠ¥ (+, âˆ’, Ã—, Ã·)</li>
            </ul>
            
            <h4>ğŸ“ êµìœ¡ ëª©ì </h4>
            <p>ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ìƒëª…ê³¼í•™ ìˆ˜ì—…ì„ ìœ„í•´ ê°œë°œë˜ì—ˆìœ¼ë©°, ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì´ë¡ ì„ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            
            <h4>ğŸ“§ ë¬¸ì˜</h4>
            <p>ê°œë°œì: ì‹ ë„ê²½ (ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ)<br>
            ë¸”ë¡œê·¸: Standbio</p>
        </div>
    </div>

    <script>
        // ìƒìˆ˜ ì •ì˜
        const umToPx = (um) => um / (5.0 / 700);
        const aBandUm = 1.8;
        const iBandUm = 1.8;
        const actinUm = 1.8;
        const actinLength = umToPx(actinUm);
        const myosinLength = umToPx(aBandUm);
        const centerX = (750 + 50) / 2;
        const myosinStart = 270;
        const myosinEnd = myosinStart + myosinLength;
        const baselineSarcomere = 4.5; // ê¸°ì¤€ê°’

        // ê·¼ì ˆ ê¸¸ì´ í…Œì´ë¸”
        const sarcomereLengthTable = Array.from({ length: 19 }, (_, i) => 5.4 - i * 0.1);

        // ì„ íƒ ê°€ëŠ¥í•œ ê¸¸ì´ ì˜µì…˜
        const lengthOptions = [
            "AëŒ€ ê¸¸ì´", "ë§ˆì´ì˜¤ì‹ ", "ì•¡í‹´", "HëŒ€ ê¸¸ì´", 
            "IëŒ€ ê¸¸ì´", "ê²¹ì¹˜ëŠ” êµ¬ê°„", "Â½ IëŒ€ ê¸¸ì´", "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„"
        ];

        // ê¸°ì¤€ê°’
        const referenceValues = {
            "HëŒ€ ê¸¸ì´": 1.8,
            "IëŒ€ ê¸¸ì´": 3.6,
            "Â½ IëŒ€ ê¸¸ì´": 1.8,
            "ê²¹ì¹˜ëŠ” êµ¬ê°„": 0,
            "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„": 0
        };

        // ê³„ì‚°ê¸° ìƒíƒœ
        let calculatorRows = Array(6).fill(null).map(() => ["", "+", ""]);

        // ëª¨ë‹¬ ì œì–´
        function openModal(type) {
            document.getElementById(type + 'Modal').style.display = 'block';
        }

        function closeModal(type) {
            document.getElementById(type + 'Modal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // SVG ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawMuscle(sarcomereUm) {
            const svg = document.getElementById('muscleSvg');
            svg.innerHTML = '';

            const minSarcomereUm = 2 * actinUm;
            sarcomereUm = Math.max(sarcomereUm, minSarcomereUm);

            const pxToUm = 5.0 / 700;
            const pxLength = sarcomereUm / pxToUm;
            const leftZ = centerX - pxLength / 2;
            const rightZ = centerX + pxLength / 2;

            const hStart = leftZ + actinLength;
            const hEnd = rightZ - actinLength;

            // Zì„ 
            svg.innerHTML += `
                <line x1="${leftZ}" y1="80" x2="${leftZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <line x1="${rightZ}" y1="80" x2="${rightZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <text x="${leftZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">Zì„ </text>
                <text x="${rightZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">Zì„ </text>
            `;

            // ì•¡í‹´ í•„ë¼ë©˜íŠ¸
            [100, 140, 180, 220].forEach(y => {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                    <rect x="${rightZ - actinLength}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                `;
            });

            // ë§ˆì´ì˜¤ì‹  í•„ë¼ë©˜íŠ¸
            [120, 160, 200].forEach(y => {
                svg.innerHTML += `<rect x="${myosinStart}" y="${y}" width="${myosinLength}" height="18" fill="#DC143C" rx="4"/>`;
            });

            // Mì„ 
            const mLineX = (myosinStart + myosinEnd) / 2;
            svg.innerHTML += `
                <line x1="${mLineX}" y1="80" x2="${mLineX}" y2="220" stroke="#FFA500" stroke-width="3" stroke-dasharray="5 5"/>
                <text x="${mLineX}" y="70" font-size="14" text-anchor="middle" fill="#FFA500" font-weight="bold">Mì„ </text>
            `;

            // AëŒ€
            svg.innerHTML += `
                <rect x="${myosinStart}" y="40" width="${myosinLength}" height="12" stroke="#333" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                <text x="${mLineX}" y="30" font-size="14" text-anchor="middle" font-weight="bold">AëŒ€</text>
            `;

            // HëŒ€
            if (hEnd > hStart) {
                svg.innerHTML += `
                    <rect x="${hStart}" y="250" width="${hEnd - hStart}" height="12" stroke="#4169E1" fill="rgba(65,105,225,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(hStart + hEnd) / 2}" y="280" font-size="14" text-anchor="middle" fill="#4169E1" font-weight="bold">HëŒ€</text>
                `;
            }

            // IëŒ€
            if (myosinStart > leftZ) {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="270" width="${myosinStart - leftZ}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(leftZ + myosinStart) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">Â½ IëŒ€</text>
                `;
            }
            if (rightZ > myosinEnd) {
                svg.innerHTML += `
                    <rect x="${myosinEnd}" y="270" width="${rightZ - myosinEnd}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(rightZ + myosinEnd) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">Â½ IëŒ€</text>
                `;
            }
        }

        // ê¸¸ì´ ê³„ì‚°
        function calculateLengths(sarcomereUm) {
            const contractionUm = 5.4 - sarcomereUm;
            const hBandUm = Math.max(0, 1.8 - contractionUm);
            const iBandUmCurrent = Math.max(0, sarcomereUm - aBandUm);
            const iHalfBandUm = iBandUmCurrent / 2;
            const overlapUm = contractionUm;

            return {
                "AëŒ€ ê¸¸ì´": aBandUm,
                "ë§ˆì´ì˜¤ì‹ ": aBandUm,
                "ì•¡í‹´": actinUm,
                "HëŒ€ ê¸¸ì´": hBandUm,
                "IëŒ€ ê¸¸ì´": 2 * iHalfBandUm,
                "ê²¹ì¹˜ëŠ” êµ¬ê°„": overlapUm,
                "Â½ IëŒ€ ê¸¸ì´": iHalfBandUm,
                "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„": overlapUm / 2
            };
        }

        // ë³€í™” ì •ë³´ ì—…ë°ì´íŠ¸
        function updateChanges(lengths) {
            const changesList = document.getElementById('changesList');
            const items = [
                { name: "HëŒ€ ê¸¸ì´", value: lengths["HëŒ€ ê¸¸ì´"], ref: 1.8 },
                { name: "IëŒ€ ê¸¸ì´", value: lengths["IëŒ€ ê¸¸ì´"], ref: 3.6 },
                { name: "ê²¹ì¹˜ëŠ” êµ¬ê°„", value: lengths["ê²¹ì¹˜ëŠ” êµ¬ê°„"], ref: 0 },
                { name: "Â½ IëŒ€ ê¸¸ì´", value: lengths["Â½ IëŒ€ ê¸¸ì´"], ref: 1.8 },
                { name: "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„", value: lengths["Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„"], ref: 0 }
            ];

            changesList.innerHTML = items.map(item => {
                const delta = item.value - item.ref;
                const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : 'delta-info';
                return `<li>${item.name}: <strong>${item.value.toFixed(2)} Î¼m</strong> <span class="${deltaClass}">(Î” ${delta.toFixed(2)} Î¼m)</span></li>`;
            }).join('');
        }

        // ê³„ì‚°ê¸° í…Œì´ë¸” ìƒì„±
        function createCalculatorTable() {
            const table = document.getElementById('calculatorTable');
            table.innerHTML = '';

            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                
                // ì„ íƒ 1
                const select1 = document.createElement('select');
                select1.innerHTML = '<option value="">ì„ íƒ ì•ˆ í•¨</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select1.value = calculatorRows[i][0];
                select1.onchange = () => {
                    calculatorRows[i][0] = select1.value;
                    updateCalculator();
                };

                // ì—°ì‚°ì ì„ íƒ
                const selectOp = document.createElement('select');
                selectOp.className = 'operator-select';
                selectOp.innerHTML = `
                    <option value="+">+</option>
                    <option value="-">âˆ’</option>
                    <option value="*">Ã—</option>
                    <option value="/">Ã·</option>
                `;
                selectOp.value = calculatorRows[i][1];
                selectOp.onchange = () => {
                    calculatorRows[i][1] = selectOp.value;
                    updateCalculator();
                };

                // ì„ íƒ 2
                const select2 = document.createElement('select');
                select2.innerHTML = '<option value="">ì„ íƒ ì•ˆ í•¨</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select2.value = calculatorRows[i][2];
                select2.onchange = () => {
                    calculatorRows[i][2] = select2.value;
                    updateCalculator();
                };

                const td1 = document.createElement('td');
                td1.appendChild(select1);
                const td2 = document.createElement('td');
                td2.appendChild(selectOp);
                const td3 = document.createElement('td');
                td3.appendChild(select2);
                const td4 = document.createElement('td');
                td4.id = `calc-result-${i}`;

                row.appendChild(td1);
                row.appendChild(td2);
                row.appendChild(td3);
                row.appendChild(td4);
                table.appendChild(row);
            }
        }

        // ê³„ì‚°ê¸° ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateCalculator() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const lengths = calculateLengths(sarcomereUm);

            calculatorRows.forEach((row, idx) => {
                const resultCell = document.getElementById(`calc-result-${idx}`);
                const [key1, operator, key2] = row;
                
                if (!key1 && !key2) {
                    resultCell.textContent = '-';
                } else if (!key1 || !key2) {
                    resultCell.textContent = 'ê°’ì„ ì„ íƒí•˜ì„¸ìš”';
                    resultCell.style.color = '#999';
                } else {
                    const v1 = lengths[key1] || 0;
                    const v2 = lengths[key2] || 0;
                    let result;
                    let operatorSymbol;
                    
                    switch(operator) {
                        case '+':
                            result = v1 + v2;
                            operatorSymbol = '+';
                            break;
                        case '-':
                            result = v1 - v2;
                            operatorSymbol = 'âˆ’';
                            break;
                        case '*':
                            result = v1 * v2;
                            operatorSymbol = 'Ã—';
                            break;
                        case '/':
                            result = v2 !== 0 ? v1 / v2 : 0;
                            operatorSymbol = 'Ã·';
                            if (v2 === 0) {
                                resultCell.textContent = '0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                                resultCell.style.color = '#dc3545';
                                return;
                            }
                            break;
                        default:
                            result = v1 + v2;
                            operatorSymbol = '+';
                    }
                    
                    // ê¸°ì¤€ê°’ ê³„ì‚° (ë”í•˜ê¸°ì¼ ë•Œë§Œ Î” í‘œì‹œ)
                    if (operator === '+') {
                        const ref1 = referenceValues[key1] || 0;
                        const ref2 = referenceValues[key2] || 0;
                        const delta = result - (ref1 + ref2);
                        const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : '';
                        resultCell.innerHTML = `${result.toFixed(2)} Î¼m <span class="${deltaClass}">(Î” ${delta.toFixed(2)} Î¼m)</span>`;
                    } else {
                        // ë‹¤ë¥¸ ì—°ì‚°ì€ ê²°ê³¼ë§Œ í‘œì‹œ
                        resultCell.innerHTML = `<strong>${result.toFixed(2)}</strong> ${operator === '/' ? '' : 'Î¼m'}`;
                    }
                    resultCell.style.color = '#333';
                }
            });
        }

        // ë©”ì¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function update() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const delta = sarcomereUm - baselineSarcomere;
            
            document.getElementById('lengthDisplay').textContent = `${sarcomereUm.toFixed(2)} Î¼m`;
            
            // ê¸°ì¤€ê°’ê³¼ì˜ ì°¨ì´ í‘œì‹œ
            const deltaDisplay = document.getElementById('deltaDisplay');
            if (Math.abs(delta) < 0.01) {
                deltaDisplay.textContent = '(ê¸°ì¤€ê°’)';
                deltaDisplay.style.color = '#666';
            } else {
                const sign = delta > 0 ? '+' : '';
                deltaDisplay.textContent = `(${sign}${delta.toFixed(2)} Î¼m)`;
                deltaDisplay.style.color = delta > 0 ? '#28a745' : '#dc3545';
            }
            
            drawMuscle(sarcomereUm);
            
            const lengths = calculateLengths(sarcomereUm);
            updateChanges(lengths);
            updateCalculator();
        }

        // ì´ˆê¸°í™”
        document.getElementById('sarcomereSlider').addEventListener('input', update);
        createCalculatorTable();
        update();
    </script>
</body>
</html>
